<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Saharos Kanban - Plugin System Demo</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: #f0f2f5;
    }

    .header {
      background: #fff;
      padding: 1.5rem 2rem;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      margin-bottom: 1rem;
    }

    .header h1 {
      font-size: 1.5rem;
      color: #333;
      margin-bottom: 0.5rem;
    }

    .header p {
      color: #666;
      font-size: 0.875rem;
      margin-bottom: 1rem;
    }

    .plugin-info {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }

    .plugin-card {
      background: #f9f9f9;
      border-left: 4px solid #2196f3;
      padding: 1rem;
      border-radius: 4px;
    }

    .plugin-card h3 {
      font-size: 0.875rem;
      color: #1976d2;
      margin-bottom: 0.5rem;
      font-weight: 600;
    }

    .plugin-card p {
      font-size: 0.75rem;
      color: #555;
      line-height: 1.4;
    }

    .plugin-card.wip {
      border-left-color: #ff9800;
    }

    .plugin-card.aging {
      border-left-color: #f44336;
    }

    .plugin-card.collapse {
      border-left-color: #4caf50;
    }

    .container {
      height: calc(100vh - 340px);
      max-width: 1400px;
      margin: 0 auto;
    }

    #board {
      height: 100%;
    }

    .controls {
      padding: 1rem 2rem;
      background: #fff;
      display: flex;
      gap: 1rem;
      align-items: center;
      flex-wrap: wrap;
    }

    button {
      padding: 0.5rem 1rem;
      background: #0288d1;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.875rem;
      font-weight: 500;
      transition: background 0.2s;
    }

    button:hover {
      background: #0277bd;
    }

    button.secondary {
      background: #757575;
    }

    button.secondary:hover {
      background: #616161;
    }

    .info {
      margin-left: auto;
      color: #666;
      font-size: 0.875rem;
    }

    /* Plugin-specific styles */
    
    /* WIP Limit Plugin */
    .sk-wip-at-limit {
      border-color: #ff9800 !important;
    }

    .sk-wip-exceeded {
      border-color: #f44336 !important;
      background: #ffebee !important;
    }

    .sk-wip-warning {
      animation: wipWarning 0.5s ease-in-out 2;
    }

    @keyframes wipWarning {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }

    .sk-column[data-wip-limit]::before {
      content: attr(data-wip-count) '/' attr(data-wip-limit);
      position: absolute;
      top: 8px;
      right: 8px;
      background: #e0e0e0;
      color: #666;
      font-size: 0.75rem;
      padding: 2px 6px;
      border-radius: 10px;
      font-weight: 600;
    }

    .sk-column.sk-wip-at-limit::before {
      background: #ff9800;
      color: white;
    }

    .sk-column.sk-wip-exceeded::before {
      background: #f44336;
      color: white;
    }

    /* Card Aging Plugin */
    .sk-card-aging-warning {
      border-left: 4px solid #ff9800;
    }

    .sk-card-aging-danger {
      border-left: 4px solid #f44336;
      background: #fff3e0 !important;
    }

    .sk-card[data-card-days]::after {
      content: attr(data-card-days) ' days';
      display: inline-block;
      font-size: 0.65rem;
      color: #999;
      margin-top: 0.5rem;
      padding: 2px 6px;
      background: #f5f5f5;
      border-radius: 3px;
    }

    .sk-card.sk-card-aging-warning::after {
      background: #fff3e0;
      color: #f57c00;
    }

    .sk-card.sk-card-aging-danger::after {
      background: #ffebee;
      color: #c62828;
      font-weight: 600;
    }

    /* Column Collapse Plugin */
    .sk-column-collapsed {
      transition: all 0.3s ease;
    }

    .legend {
      position: fixed;
      bottom: 0;
      left: 0;
      background: white;
      border: 1px solid #ddd;
      border-radius: 0 4px 0 0;
      padding: 1rem;
      max-width: 300px;
      font-size: 0.75rem;
      box-shadow: 0 -2px 8px rgba(0,0,0,0.1);
    }

    .legend h4 {
      margin-bottom: 0.5rem;
      font-size: 0.875rem;
      color: #333;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.25rem;
    }

    .legend-color {
      width: 16px;
      height: 16px;
      border-radius: 2px;
    }

    @media (max-width: 768px) {
      .plugin-info {
        grid-template-columns: 1fr;
      }

      .legend {
        display: none;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>Saharos Kanban - Plugin System Demo</h1>
    <p>Milestone 6 - Extensible plugin architecture with WIP limits, card aging, and column collapsing</p>
    
    <div class="plugin-info">
      <div class="plugin-card wip">
        <h3>üö¶ WIP Limit Plugin</h3>
        <p>Columns show card count vs. limit. Orange = at limit, Red = exceeded. Try moving cards to "Doing" (limit: 3)!</p>
      </div>
      <div class="plugin-card aging">
        <h3>‚è∞ Card Aging Plugin</h3>
        <p>Cards show how long they've been in a column. Orange border = 3+ days, Red = 7+ days. Ages reset when moved.</p>
      </div>
      <div class="plugin-card collapse">
        <h3>‚ûñ Column Collapse Plugin</h3>
        <p>Click the "‚àí" button in column headers to collapse/expand. State persists in localStorage!</p>
      </div>
    </div>
  </div>

  <div class="controls">
    <button onclick="addCard()">Add Card</button>
    <button onclick="ageCard()">Age Random Card (Test)</button>
    <button onclick="resetAges()">Reset All Ages</button>
    <button class="secondary" onclick="logState()">Log State</button>
    <div class="info">All 3 plugins active! üîå</div>
  </div>

  <div class="container">
    <div id="board"></div>
  </div>

  <div class="legend">
    <h4>Visual Indicators</h4>
    <div class="legend-item">
      <div class="legend-color" style="background: #e0e0e0;"></div>
      <span>WIP: Normal</span>
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background: #ff9800;"></div>
      <span>WIP: At Limit</span>
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background: #f44336;"></div>
      <span>WIP: Exceeded</span>
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background: transparent; border: 2px solid #ff9800;"></div>
      <span>Age: 3+ days</span>
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background: transparent; border: 2px solid #f44336;"></div>
      <span>Age: 7+ days</span>
    </div>
  </div>

  <script type="module">
    import { SaharosKanban } from '../src/index.ts';
    import { 
      wipLimitPlugin, 
      cardAgingPlugin, 
      columnCollapsePlugin 
    } from '../src/core/plugins.ts';

    // Sample data with WIP limits in metadata
    const initialData = {
      columns: [
        { 
          id: 'backlog', 
          title: 'Backlog',
          meta: { wipLimit: null } // No limit
        },
        { 
          id: 'todo', 
          title: 'To Do',
          meta: { wipLimit: 5 }
        },
        { 
          id: 'doing', 
          title: 'Doing',
          meta: { wipLimit: 3 } // Strict limit!
        },
        { 
          id: 'review', 
          title: 'Review',
          meta: { wipLimit: 2 }
        },
        { 
          id: 'done', 
          title: 'Done',
          meta: { wipLimit: null }
        }
      ],
      cards: [
        {
          id: 1,
          title: 'Implement plugin system core',
          description: 'Create plugin context and use() method',
          columnId: 'done',
          labels: ['backend', 'milestone-6']
        },
        {
          id: 2,
          title: 'Create WIP limit plugin',
          description: 'Visual indicators and enforcement',
          columnId: 'done',
          labels: ['plugin', 'milestone-6']
        },
        {
          id: 3,
          title: 'Create card aging plugin',
          description: 'Track time in column and show warnings',
          columnId: 'done',
          labels: ['plugin', 'milestone-6']
        },
        {
          id: 4,
          title: 'Create column collapse plugin',
          description: 'Allow collapsing columns to save space',
          columnId: 'done',
          labels: ['plugin', 'milestone-6']
        },
        {
          id: 5,
          title: 'Write plugin documentation',
          description: 'API docs and usage examples',
          columnId: 'doing',
          labels: ['docs'],
          meta: { movedAt: Date.now() - (1000 * 60 * 60 * 24 * 2) } // 2 days old
        },
        {
          id: 6,
          title: 'Create plugin demo page',
          description: 'Interactive example with all plugins',
          columnId: 'doing',
          labels: ['frontend'],
          meta: { movedAt: Date.now() - (1000 * 60 * 60 * 24 * 4) } // 4 days old (warning)
        },
        {
          id: 7,
          title: 'Test plugins with keyboard navigation',
          description: 'Ensure a11y compatibility',
          columnId: 'doing',
          labels: ['testing', 'a11y'],
          meta: { movedAt: Date.now() - (1000 * 60 * 60 * 24 * 1) } // 1 day old
        },
        {
          id: 8,
          title: 'Performance test with plugins',
          description: 'Benchmark plugin overhead',
          columnId: 'review',
          labels: ['testing'],
          meta: { movedAt: Date.now() - (1000 * 60 * 60 * 24 * 8) } // 8 days old (danger!)
        },
        {
          id: 9,
          title: 'Add plugin helper utilities',
          description: 'Debounce, throttle, CSS injection',
          columnId: 'review',
          labels: ['utils'],
          meta: { movedAt: Date.now() - (1000 * 60 * 60 * 24 * 5) } // 5 days old (warning)
        },
        {
          id: 10,
          title: 'Research community plugin ideas',
          description: 'Gather feedback on desired plugins',
          columnId: 'backlog',
          labels: ['research']
        }
      ]
    };

    // Initialize board with all plugins
    const board = new SaharosKanban('#board', {
      columns: initialData.columns,
      cards: initialData.cards,
      debug: true,
      plugins: [
        // WIP Limit Plugin - warns when limits exceeded
        wipLimitPlugin({
          showWarning: true,
          onLimitExceeded: (column, limit, current) => {
            console.warn(`‚ö†Ô∏è WIP Limit Exceeded! Column "${column.title}" has ${current} cards (limit: ${limit})`);
          }
        }),
        
        // Card Aging Plugin - shows time in column
        cardAgingPlugin({
          days: { warning: 3, danger: 7 },
        }),
        
        // Column Collapse Plugin - collapsible columns
        columnCollapsePlugin({
          storageKey: 'sk-demo-collapsed-columns'
        })
      ],
      on: {
        'board:ready': () => {
          console.log('‚úÖ Board ready with 3 active plugins!');
          console.log('üîå Plugins: WIP Limits, Card Aging, Column Collapse');
        },
        'state:change': () => {
          // Plugins automatically react to state changes
        },
        'card:drag:end': ({ card, from, to }) => {
          console.log(`üéØ Moved "${card.title}" from "${from.title}" to "${to.title}"`);
        }
      }
    });

    // Global functions for buttons
    window.board = board;
    
    window.addCard = () => {
      board.addCard({
        id: Date.now(),
        title: `New Task ${Math.floor(Math.random() * 1000)}`,
        description: 'Added to test WIP limits',
        columnId: 'doing', // Add to column with strict WIP limit
        labels: ['new']
      });
    };

    window.ageCard = () => {
      const state = board.getState();
      const randomCard = state.cards[Math.floor(Math.random() * state.cards.length)];
      
      if (randomCard) {
        if (!randomCard.meta) randomCard.meta = {};
        // Set to 10 days ago
        randomCard.meta.movedAt = Date.now() - (1000 * 60 * 60 * 24 * 10);
        board.loadState(state);
        console.log(`‚è∞ Aged card "${randomCard.title}" to 10 days old`);
      }
    };

    window.resetAges = () => {
      const state = board.getState();
      state.cards.forEach(card => {
        if (card.meta) {
          card.meta.movedAt = Date.now();
        }
      });
      board.loadState(state);
      console.log('üîÑ Reset all card ages');
    };

    window.logState = () => {
      console.log('Current state:', board.getState());
    };

    // Log plugin info
    console.log('');
    console.log('üîå Plugin System Demo');
    console.log('====================');
    console.log('');
    console.log('Active Plugins:');
    console.log('  1. WIP Limit - Visual indicators for work-in-progress limits');
    console.log('  2. Card Aging - Track how long cards stay in columns');
    console.log('  3. Column Collapse - Collapse/expand columns to save space');
    console.log('');
    console.log('Try this:');
    console.log('  ‚Ä¢ Move cards to "Doing" column (WIP limit: 3)');
    console.log('  ‚Ä¢ Watch the counter turn orange/red when limit exceeded');
    console.log('  ‚Ä¢ Click "‚àí" button on any column to collapse it');
    console.log('  ‚Ä¢ Check the colored borders on aged cards');
    console.log('');
  </script>
</body>
</html>
